<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Messages for Everyone</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
  <div class="container mx-auto p-4 max-w-2xl bg-white shadow-lg rounded-lg mt-8">
    <% if (locals.user) { %>
      <h1 class="text-3xl font-bold text-gray-800 mb-6">Messages by users</h1>

      <% if(locals.messages && locals.messages.length) { %>
        <div class="space-y-6">
          <% locals.messages.forEach((message)=> { %>
            <div class="bg-gray-50 p-4 rounded-md shadow-sm border border-gray-200">
              <h2 class="text-xl font-semibold text-gray-700 mb-2">
                <%= message.title %>
              </h2>
              <p class="text-gray-600 mb-3">
                <%= message.text %>
              </p>

              <% if (locals.user.membership_status) { %>
                <div class="text-sm text-gray-500 flex justify-between items-center">
                  <span>
                    <%= new Date(message.timestamp).toLocaleString() %>
                  </span>
                  <span class="font-medium text-gray-700">Posted by: <%= message.username %></span>
                </div>
                <% } else { %>
                  <!-- <p class="text-sm text-blue-600 italic">Become a member to see full details!</p> -->
                  <% }%>
                    <% if (locals.user.is_admin) { %>
                      <form action="/delete-message" class="mt-1" method="POST">
                        <input type="hidden" name="m_id" id="m_id" value="<%= message.message_id %>">
                        <button type="submit" class="bg-red-200 p-1.5">Delete Message</button>
                      </form>
                      <% } %>
            </div>
            <% }) %>
        </div>
        <% } else { %>
          <p class="text-gray-600 text-center py-4">No messages to display yet.</p>
          <% } %>

            <div class="mt-8 flex justify-between items-center border-t pt-6 border-gray-200">
              <form action="/logout" method="post">
                <button type="submit"
                  class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                  Sign out
                </button>
              </form>
              <a href="/create-post"
                class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                Create a new Post
              </a>
            </div>

            <% if(!locals.user.membership_status) { %>
              <div class="mt-8 text-center border-t pt-6 border-gray-200">
                <a href="/password" class="text-blue-600 hover:text-blue-800 text-lg font-medium">Join the Club!</a>
              </div>
              <%} %>
                <% } else { %>
                  <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Please log in</h1>
                  <div class="flex flex-col space-y-4 items-center">
                    <a href="/sign-in" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md w-full max-w-xs text-center focus:outline-none 
                      focus:ring-2 focus:ring-green-500 focus:ring-opacity-50">
                      Login
                    </a>
                    <a href="/sign-up" class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded-md w-full max-w-xs text-center 
                      focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                      Sign Up
                    </a>
                  </div>
                  <% } %>
  </div>
</body>

</html>